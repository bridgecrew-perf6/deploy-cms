FROM python:3.8-slim

ENV APP_HOME /app
WORKDIR $APP_HOME

ARG DJANGO_DEBUG
ARG DJANGO_SECRET_KEY
ARG DJANGO_DB_NAME
ARG DJANGO_DB_USER
ARG DJANGO_DB_PASSWORD
ARG DJANGO_DB_HOST
ARG DJANGO_DB_PORT

ARG AWS_ACCESS_KEY_ID
ARG AWS_SECRET_ACCESS_KEY
ARG AWS_STORAGE_BUCKET_NAME
ARG AWS_S3_CUSTOM_DOMAIN

ENV DJANGO_DEBUG=$DJANGO_DEBUG
ENV DJANGO_SECRET_KEY=$DJANGO_SECRET_KEY
ENV DJANGO_DB_NAME=$DJANGO_DB_NAME
ENV DJANGO_DB_USER=$DJANGO_DB_USER
ENV DJANGO_DB_PASSWORD=$DJANGO_DB_PASSWORD
ENV DJANGO_DB_HOST=$DJANGO_DB_HOST
ENV DJANGO_DB_PORT=$DJANGO_DB_PORT

ENV AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID
ENV AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY
ENV AWS_STORAGE_BUCKET_NAME=$AWS_STORAGE_BUCKET_NAME
ENV AWS_S3_CUSTOM_DOMAIN=$AWS_S3_CUSTOM_DOMAIN

COPY requirements.txt .

RUN pip install -r requirements.txt

COPY . .

ENV PORT 8080

ENV PYTHONUNBUFFERED TRUE

COPY ./entrypoint.sh /
ENTRYPOINT ["sh", "/entrypoint.sh"]
